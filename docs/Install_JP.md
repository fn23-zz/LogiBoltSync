# LogiBoltSync 導入手順

本手順書は、LogiBoltSyncをWindows PCにインストールし、キーボードの切り替えに連動してマウスも自動で切り替わる環境を構築するためのガイドです。

双方向の完全な自動切り替え環境（PC1からPC2、およびPC2からPC1）を構築するためには、**両方のPC** でこの手順を実行する必要があります。

## 前提環境

- **OS**: Windows 10 / 11
- **ハードウェア**: Logi Bolt USBレシーバーと、対応するキーボード(K855等)・マウス(MX Master 3S等)。両方のPCのレシーバーにそれぞれのデバイスがペアリングされている必要があります。
- **Python**: Python 3.10 以上

## 1. Python環境の構築

1. [Python 公式サイト](https://www.python.org/downloads/windows/)からインストーラーをダウンロードします。
2. **重要**: インストール時、画面下部の **「Add Python to PATH」** に必ずチェックを入れてインストールしてください。
3. PowerShell または コマンドプロンプトを開き、以下のコマンドでバージョンが表示されるか確認します。

   ```powershell
   python --version
   ```

## 2. 依存ライブラリのインストール

LogiBoltSyncのリポジトリをダウンロード（またはクローン）し、PowerShellで対象のディレクトリに移動してから、以下のコマンドで必要な通信ライブラリ (`hidapi`) をインストールします。

```powershell
pip install -r requirements.txt
```

## 3. コンフィグ（環境設定）の生成

Logi Bolt レシーバー内のデバイスインデックス番号はPCごとに異なるため、付属の検出ユーティリティを使って現在のPC環境専用の `config.json` を生成します。

1. キーボードとマウスが、**現在セットアップ中のPC** に接続され、操作可能な状態であることを確認します。
2. 検出ツールを実行します。

   ```powershell
   python tools\detect_devices.py
   ```

3. スクリプトがレシーバーをスキャンし、キーボードとマウスを発見します。
4. **Target Mouse Slot** （キーボードが切断された時に、マウスをどのスロットへ強制移行させるか）を数字の 1, 2, 3 で聞かれます。切り替え先のPCに割り当てているスロット番号を入力してください。
   - *設定例: PC1がスロット1、PC2がスロット2の場合。PC1でセットアップする時は「2」を入力し、PC2でセットアップする時は「1」を入力します。*
5. 完了すると、フォルダの直下に `config.json` が生成されます。

## 4. 動作確認

以下のコマンドでメインプログラムを起動して、動作をテストします。

```powershell
python src\main.py
```

実行状態のまま、キーボードの Easy-Switch 等を用いて物理的に別のPCへ切り替えてみてください。数秒以内に検知され、マウスも自動的に設定したスロットへ切り替わります。
確認が終わったら `Ctrl+C` でプログラムを停止します。

## 5. 常駐化の設定 (推奨)

PC起動時に LogiBoltSync が自動的にバックグラウンドで起動するように、タスクスケジューラに登録します。

1. **バッチファイルの作成**:
   LogiBoltSync フォルダの中に `start_logiboltsync.bat` という名前のテキストファイルを作成し、以下の1行を記述して保存します。

   ```bat
   pythonw src\main.py
   ```

   *(※ `pythonw` を使用することで、起動時に黒いコマンドプロンプト画面が表示されなくなります)*

2. Windowsで **「タスク スケジューラ」** を検索して起動します。
3. 右側のメニューから **「タスクの作成」** をクリックします。
4. **[全般] タブ**: 名前を「LogiBoltSync」などに設定し、**「最上位の特権で実行する」** にチェックを入れます。
5. **[トリガー] タブ**: 「新規」をクリックし、タスクの開始を **「ログオン時」** に設定します。
6. **[操作] タブ**: 「新規」をクリックし、プログラムのパスに先ほど作成した `start_logiboltsync.bat` を指定します。
   - **重要**: **[開始(オプション)]** の欄に、LogiBoltSyncフォルダのフルパス（例: `C:\path\to\LogiBoltSync`）を必ず入力してください。これを入れないと設定ファイルが読み込めずエラーになります。
7. 「OK」で保存します。これでPC起動時からシームレスな切り替え環境が自動化されます。
